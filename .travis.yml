sudo: required

services:
  - docker

language: go
go:
  - 1.8

env:
  global:
    - GH=mh-cbon/go-bin-deb
    - APP=go-bin-deb
    - EMAIL=mh-cbon@users.noreply.github.com
    - JEKYLL=pietromenna/jekyll-cayman-theme
    - MYAPP=go-bin-deb # to clean
    - MYEMAIL=mh-cbon@users.noreply.github.com # to clean
    - secure: F2a7VU+pXR/ogfiLiNed5FLgN+4yx+dsJBxg/eQlY/0mpZtoxGUrLpOWKanPF3iy/vNkCrVPtJWyGmtOE3gnGQLUjmPupfBH/WgCKihSXRQs8gu+ZrwzMAgr9lZY8qoLy1qZ1mAj/ZWJALPx4f1ydIV2Hqa1ICcFbbcQjbX92smdVB7FExW/vxIVlsoYuYfuhzgyRfW/DQu5IUt+snQYFBoMu9PVPjMAnetb3+FnZ7ARGfpUPeKfzBo2+RZGNna78c6JZcNZqf3EWHaSV2ur8ZK2XSTs7rvzuCst+ybtQSCDBQXkHXFCPa3V6FuUIVWFj4zDWuHlKQwB0otbzWhSPOAb3OnGBbBa9JXL3kVdUJsec73jIKQ1jFhwF0cQPETGA23vNDY/AA6em3YfvYj13tbGw1ZZkThX2fMQ88aJmmaG5pBZLAVZhOYfrxJQP053zxvSjMkCzqIwrguuoZE7DyH7C72OWGTVYAbgSuqYXgubsmb1VTf6rKFJReEor7w6ZxDQFBR0fPZo1Ja5ntIXcild20t8UWrXGRqWvMZEpVAdgKHQUffMe9UYLuyPaL/CCsjO/F/Od3iSWBbqLQPt/VszIz2CxB8ce4ye+EqdAT6Zfa5BDt6z2IW5vK/wQmHhgr+Nt8twbE1IhjgrQr2tYd7e0pIpvRNVyeiBxZ+UD8o=

before_install:
  - sudo apt-get -qq update
  - mkdir -p ${GOPATH}/bin
  - cd ~
  - curl https://glide.sh/get | sh

install:
  - cd $GOPATH/src/github.com/mh-cbon/$APP
  - glide install
  - go install

script: echo "pass"

before_deploy:
  - mkdir -p build/{386,amd64}
  - GOOS=linux GOARCH=386 go build --ldflags "-X main.VERSION=${TRAVIS_TAG}" -o build/386/$APP main.go
  - GOOS=linux GOARCH=amd64 go build --ldflags "-X main.VERSION=${TRAVIS_TAG}" -o build/amd64/$APP main.go
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-deb/master/create-pkg.sh | GH=mh-cbon/$APP sh -xe
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-rpm/master/create-pkg.sh | GH=mh-cbon/$APP sh -xe

after_deploy:
  - wget -O - https://raw.githubusercontent.com/mh-cbon/gh-pages/master/all.sh | sh -x
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-deb/master/setup-repository.sh | GH=mh-cbon/$APP EMAIL=$EMAIL sh -xe
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-rpm/master/setup-repository.sh | GH=mh-cbon/$APP EMAIL=$EMAIL sh -xe

deploy:
  provider: releases
  api_key:
    secure: H64/VU6sWHdR4q6jo1C6vVuENALn6vWLi36MRKdhnLfcHBHDnSPCEcf3L5kUYHpAksMTKigofWYAEjyEVhzCm7CI1YHR3F4JRH6MUw/0jqoE5Nm5Ms6v8siIRdhWA+2e+Fg6CTDBfEV5FHLHEVTW3wSCyMz4g4U03aUfP5bz9g2SqLp3mwR0iPQmBkLzgDp8ju5tG25aTNSJC2eU/RGSC4CF7ZW7Z1/DB0p9ufbNxWiEpR7HwrwXCwS9lys9V/D+rWecu9BUinqfUgaYAsUHEKwns5FwYsTymFBRwYGif846/WPFOI/sDQFoyhHH9K23mHVYm3c5aRvKUqRMNbV2sRudCvI9Fl4FUlPO06jw7rhzM8ubHYn039pqE2wvPYYvKVmWudWayrdvlcKyz4eI3o4X1Cth0Owb+rXMXTsiSjOpIAiiLGjCrzfD/wfTJwANn/6Y22l6vqXfxQQjt43Q1wD7m50wDss2wXL8SdfeLBCioA3AHq3zMMUAsXA0rpC5q7Wl0wo5BaWatBO/VCmHIIIaZWA0tcQOJppwfSeq2GhgU+GIklJUifZwbuwd/OWzcbHJxSqc3quqMGzGTrklBHRHYWjkmRlFU1SycxizuhtEika6oO2H/WXPHfpLYBRCQtQEznPdviTpHQs3rL8YoHATUD2tKcOEWEoilL/fLo0=
  file_glob: true
  file:
    - $MYAPP-386.deb
    - $MYAPP-amd64.deb
    - $MYAPP-386.rpm
    - $MYAPP-amd64.rpm
  skip_cleanup: true
  on:
    tags: true
