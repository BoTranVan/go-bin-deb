sudo: required

services:
  - docker

language: go
go:
  - 1.8

env:
  global:
    - GH=mh-cbon/go-bin-deb
    - APP=go-bin-deb
    - EMAIL=mh-cbon@users.noreply.github.com
    - JEKYLL=pietromenna/jekyll-cayman-theme
    - MYAPP=go-bin-deb # to clean
    - MYEMAIL=mh-cbon@users.noreply.github.com # to clean
    - secure: OdrfCMHcIrnlTT3WTubTMklx2b00U9nKDQe0aTjRDkNCNB0nB/fTvvIhhJ8+LDChcBcl0SBiy7Ok/pOEqlvreT1ri+XrPyXQq00sIz7qclxAsPcWsDQiFu8s1R3xuTc/7UG4e8V+WQOFf8bz5Hz1+tlgpHGINKidKQ6eMtFXJE1yLU7ZIyu27cumfdVgcYbBa9ut7h9oqc8VHT43/KM90BXE9mEtoisZnj1jeayZHfYNhr/WbMpj+39rkb50RMnPl+oQBEAL1Jovh0gINcCfQPdRDDlgKhSqaSFpvVWS1w2LlXcxYfbdhhtKkHGJ3ilUfWRHIGFyE1yQKbAL5SEUYPNkwdXF15uP+S0M9wmsQ5Tl48qgzJK+PbMQklc66EXobEPE8kvDiLxX3uHPLwUCR75H5Q6+3HEvEh9v7V46BNHHBS0uElq0kjr5/vYuYvljxf/hWWmZf8UbAYqV84UqwqPicmOB0ec7UJj4Ug9nF8H10bxOLDNiSl1Z+0Ha6LmO1kCRRTv4l5Yc+z21/eXGUq/h18r9ilY6KKoL3Cvlczx4uj4H4S4+46ww28cMlKYlKkoJNuwoFCqa4y4zlYmWHjDuc0rFro+cCaQ0FG3pl1szCEIh1NGcSlBFlrmzkquZop6M4S5wfWsH+zmYlaFTZ1tufo6lnaf8J008pWL6Ok8=

before_install:
  - sudo apt-get -qq update
  - mkdir -p ${GOPATH}/bin
  - cd ~
  - curl https://glide.sh/get | sh

install:
  - cd $GOPATH/src/github.com/mh-cbon/$APP
  - glide install
  - go install

script: echo "pass"

before_deploy:
  - mkdir -p build/{386,amd64}
  - GOOS=linux GOARCH=386 go build --ldflags "-X main.VERSION=${TRAVIS_TAG}" -o build/386/$APP main.go
  - GOOS=linux GOARCH=amd64 go build --ldflags "-X main.VERSION=${TRAVIS_TAG}" -o build/amd64/$APP main.go
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-deb/master/create-pkg.sh | GH=mh-cbon/$APP sh -xe
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-rpm/master/create-pkg.sh | GH=mh-cbon/$APP sh -xe

after_deploy:
  - wget -O - https://raw.githubusercontent.com/mh-cbon/gh-pages/master/all.sh | sh -x
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-deb/master/setup-repository.sh | GH=mh-cbon/$APP EMAIL=$EMAIL sh -xe
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-rpm/master/setup-repository.sh | GH=mh-cbon/$APP EMAIL=$EMAIL sh -xe

deploy:
  provider: releases
  api_key:
    secure: H64/VU6sWHdR4q6jo1C6vVuENALn6vWLi36MRKdhnLfcHBHDnSPCEcf3L5kUYHpAksMTKigofWYAEjyEVhzCm7CI1YHR3F4JRH6MUw/0jqoE5Nm5Ms6v8siIRdhWA+2e+Fg6CTDBfEV5FHLHEVTW3wSCyMz4g4U03aUfP5bz9g2SqLp3mwR0iPQmBkLzgDp8ju5tG25aTNSJC2eU/RGSC4CF7ZW7Z1/DB0p9ufbNxWiEpR7HwrwXCwS9lys9V/D+rWecu9BUinqfUgaYAsUHEKwns5FwYsTymFBRwYGif846/WPFOI/sDQFoyhHH9K23mHVYm3c5aRvKUqRMNbV2sRudCvI9Fl4FUlPO06jw7rhzM8ubHYn039pqE2wvPYYvKVmWudWayrdvlcKyz4eI3o4X1Cth0Owb+rXMXTsiSjOpIAiiLGjCrzfD/wfTJwANn/6Y22l6vqXfxQQjt43Q1wD7m50wDss2wXL8SdfeLBCioA3AHq3zMMUAsXA0rpC5q7Wl0wo5BaWatBO/VCmHIIIaZWA0tcQOJppwfSeq2GhgU+GIklJUifZwbuwd/OWzcbHJxSqc3quqMGzGTrklBHRHYWjkmRlFU1SycxizuhtEika6oO2H/WXPHfpLYBRCQtQEznPdviTpHQs3rL8YoHATUD2tKcOEWEoilL/fLo0=
  file_glob: true
  file:
    - $MYAPP-386.deb
    - $MYAPP-amd64.deb
    - $MYAPP-386.rpm
    - $MYAPP-amd64.rpm
  skip_cleanup: true
  on:
    tags: true
